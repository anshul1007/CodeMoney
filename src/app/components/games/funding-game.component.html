<div class="bg-white rounded-2xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6">
  <h3
    class="text-base sm:text-lg font-bold text-gray-800 mb-2 sm:mb-3 text-center"
  >
    How will you get the money you need?
  </h3>

  <!-- Display estimated cost -->
  <div class="text-center mb-4 sm:mb-6 p-2 sm:p-3 bg-blue-50 rounded-lg">
    <p class="text-sm sm:text-base text-blue-800">
      <span class="font-medium">You need:</span>
      <span class="font-bold">₹{{ totalEstimatedCost }}</span>
      <span
        *ngIf="totalEstimatedCost === 0"
        class="text-xs text-red-500 block mt-1"
      >
        (Please complete the cost estimation level first)
      </span>
    </p>
  </div>

  <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 mb-4 sm:mb-6">
    <div
      *ngFor="let source of fundingSources; trackBy: trackBySourceId"
      class="funding-option cursor-pointer transition-all duration-200 hover:shadow-md"
      [class.selected]="source.isSelected"
      (click)="onSourceClick(source)"
    >
      <div
        class="border-2 rounded-xl p-3 sm:p-4"
        [ngClass]="{
          'border-blue-500 bg-blue-50': source.isSelected,
          'border-gray-200 bg-white hover:border-gray-300': !source.isSelected,
        }"
      >
        <div class="flex items-start space-x-2 sm:space-x-3 mb-2 sm:mb-3">
          <span class="text-2xl sm:text-3xl">{{ source.icon }}</span>
          <div class="flex-1 min-w-0">
            <h4 class="font-bold text-gray-800 text-sm sm:text-base">
              {{ source.name }}
            </h4>
            <p class="text-xs sm:text-sm text-gray-600 break-words">
              {{ source.description }}
            </p>
          </div>
        </div>

        <!-- Amount Input -->
        <div
          *ngIf="source.isSelected && source.maxAmount! > 0"
          class="mt-2 sm:mt-3"
        >
          <label
            class="block text-xs sm:text-sm font-medium text-gray-700 mb-1"
          >
            Amount (Max: ₹{{ source.maxAmount }}):
          </label>
          <input
            type="number"
            [(ngModel)]="source.amount"
            [max]="source.maxAmount || 0"
            placeholder="0"
            class="w-full px-2 sm:px-3 py-1.5 sm:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base"
            (input)="onAmountChange()"
          />
        </div>
      </div>
    </div>
  </div>

  <!-- Funding Summary -->
  <div class="bg-gray-50 rounded-lg p-3 sm:p-4">
    <h4 class="font-bold text-gray-800 mb-2 text-sm sm:text-base">
      Funding Summary:
    </h4>
    <div class="space-y-1 text-xs sm:text-sm">
      <div
        *ngFor="let source of getSelectedSources()"
        class="flex justify-between"
      >
        <span class="truncate pr-2">{{ source.name }}</span>
        <span class="font-medium">₹{{ source.amount || 0 }}</span>
      </div>
      <div class="border-t pt-2 mt-2 flex justify-between font-bold">
        <span>Total Available:</span>
        <span class="text-green-600">₹{{ totalFunding }}</span>
      </div>

      <div *ngIf="totalEstimatedCost > 0" class="border-t pt-2 mt-2">
        <div class="flex justify-between font-bold">
          <span>Total Needed:</span>
          <span class="text-blue-600">₹{{ totalEstimatedCost }}</span>
        </div>
        <div class="mt-2 text-right">
          <span
            [ngClass]="{
              'text-red-500': !isFundingSufficient,
              'text-green-500': isFundingSufficient,
            }"
            class="text-xs font-medium"
          >
            <span *ngIf="!isFundingSufficient">
              <span class="mr-1">⚠️</span> You need ₹{{ fundingGap }} more!
            </span>
            <span *ngIf="isFundingSufficient">
              <span class="mr-1">✅</span> You have enough funding!
            </span>
          </span>
        </div>
      </div>
    </div>
  </div>
</div>
